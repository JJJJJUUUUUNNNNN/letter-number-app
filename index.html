<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Letter Number OCR</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body {
  margin: 0;
  background: #000;
  color: #0f0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}
#video {
  width: 100%;
  max-height: 60vh;
  object-fit: contain;
}
button {
  margin: 6px;
  padding: 10px;
}
#status {
  padding: 8px;
}
</style>
</head>

<body>

<div>
  <button id="start">Start</button>
  <button id="flip">Flip</button>
</div>

<div id="status">idle</div>

<video id="video" autoplay playsinline></video>

<script>
const video = document.getElementById('video');
const statusEl = document.getElementById('status');
let stream = null;
let facing = "environment";

async function startCamera() {
  if (stream) {
    stream.getTracks().forEach(t => t.stop());
  }
  stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: facing }
  });
  video.srcObject = stream;
}

document.getElementById('start').onclick = async () => {
  statusEl.textContent = 'loading OCR...';

  await startCamera();

  const worker = await Tesseract.createWorker({
    langPath: 'tessdata',
    logger: m => {
      if (m.progress !== undefined) {
        statusEl.textContent =
          `${m.status} ${Math.round(m.progress * 100)}%`;
      }
    }
  });

  await worker.loadLanguage('eng');
  await worker.initialize('eng');

  statusEl.textContent = 'OCR running';

  setInterval(async () => {
    const { data } = await worker.recognize(video);
    console.log(data.text);
  }, 3000);
};

document.getElementById('flip').onclick = () => {
  facing = facing === "environment" ? "user" : "environment";
  startCamera();
};
</script>

</body>
</html>
